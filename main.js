(()=>{"use strict";const t=class{constructor(t,e){this._conf=t,this._form=e,this._inputSelector=t.inputSelector,this._submitButtonSelector=t.submitButtonSelector,this._inputErrorClass=t.inputErrorClass,this._errorClass=t.errorClass,this._inactiveButtonClass=t.inactiveButtonClass,this._buttonElement=this._form.querySelector(this._submitButtonSelector),this._inputList=Array.from(this._form.querySelectorAll(this._inputSelector))}_hideInputError=t=>{this._errorElement=this._form.querySelector(`#${t.id}-error`),t.classList.remove(this._inputErrorClass),this._errorElement.classList.remove(this._errorClass),this._errorElement.textContent=""};_showInputError=t=>{const e=this._form.querySelector(`#${t.id}-error`);t.classList.add(this._inputErrorClass),e.textContent=t.validationMessage,e.classList.add(this._errorClass)};_checkInputValidity=t=>{t.validity.valid?this._hideInputError(t):this._showInputError(t)};_hazInvalidInput=()=>this._inputList.some((t=>!t.validity.valid));_toggleButtonState=()=>{this._hazInvalidInput(this._inputList)?(this._buttonElement.disabled=!0,this._buttonElement.classList.add(this._inactiveButtonClass)):(this._buttonElement.disabled=!1,this._buttonElement.classList.remove(this._inactiveButtonClass))};_setEventListeners=()=>{this._form.addEventListener("submit",(t=>{t.preventDefault()})),Array.from(this._form.querySelectorAll(this._inputSelector)),this._inputList.forEach((t=>{t.addEventListener("input",(e=>{e.preventDefault(),this._checkInputValidity(t),this._toggleButtonState()})),this._toggleButtonState()}))};enableValidation=()=>{this._setEventListeners()};checkFormValidity=()=>{this._inputList.forEach((t=>{this._hideInputError(t),this._toggleButtonState()}))}},e={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__button-save",inactiveButtonClass:"button_disable",inputErrorClass:"form__input_error",errorClass:"form__input-error_active"},s=class{constructor(t){this._selector=t,this._popup=document.querySelector(this._selector)}open(){this._popup.classList.add("popup_is-opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("popup_is-opened"),this._popup.removeEventListener("mousedown",this._handleEscClose)}_handleEscClose=t=>{"Escape"===t.key&&this.close()};setEventListeners(){this._popup.addEventListener("mousedown",(t=>{(t.target===t.currentTarget||t.target.classList.contains("popup__close-button"))&&this.close()}))}};class r extends s{constructor(t,e){super(t),this._callBack=e.bind(this),this._form=this._popup.querySelector("form")}open=()=>{super.open()};close=()=>{super.close(),this._form.reset()};setEventListeners=()=>{super.setEventListeners(),this._form.addEventListener("submit",(t=>{t.preventDefault(),this._callBack(this._getInputValues())}))};_getInputValues=()=>(this._formValues={},this._form.querySelectorAll("input").forEach((t=>{this._formValues[t.name]=t.value})),this._formValues)}const o=new class{constructor(t){this._selector=t,this._elements=document.querySelector(t)}addItem(t){this._elements.prepend(t)}}(".elements__list"),i=document.querySelector(".profile-edit-form"),n=document.querySelector(".add-place-form"),a=document.querySelector(".profile-img-edit-popup"),c=document.querySelector(".delete-card-form"),l=new t(e,n);l.enableValidation();const h=new t(e,i);h.enableValidation();const d=new t(e,a);d.enableValidation();const _=new class{constructor(t,e,s){this._nameSelector=t,this._aboutSelector=e,this._nameField=document.querySelector(this._nameSelector),this._aboutField=document.querySelector(this._aboutSelector),this._avatarSelector=s,this._avatarImg=document.querySelector(this._avatarSelector)}getUserInfo(){return{name:this._nameField.textContent,about:this._aboutField.textContent,avatar:this._avatarImg.src,id:this._id}}setUserInfo(t,e,s){this._nameField.textContent=t,this._aboutField.textContent=e,this._id=s}setUserAvatar(t){this._avatarImg.src=t}setUserId(t){this._id=t}}(".profile__name",".profile__prof",".profile__avatar-img"),u=new r(".profile-edit-popup",(function(t){const e=i.querySelector(".form__button-save"),s=e.textContent;e.textContent="Сохранение...",v.patchUserInfo(t.fild_name,t.fild_about).then((t=>{_.setUserInfo(t.name,t.about),u.close()})).finally((()=>{e.textContent=s}))}));function p(t){return new class{constructor(t,e,s,r,o,i,n){this._template=document.querySelector(e).content,this._data=t,this._openPopupWithImage=o,this._openPopupDeleteCard=i,this._userId=s.getUserInfo().id,this._api=r,this._popup=n}_openImgPopup=()=>{this._openPopupWithImage.open(this._cardImg,this._cardText)};_deleteCard=()=>{this._popup.open(),this._popup.setConfirmHandler((()=>{this._api.deleteCard(this._data._id).then((()=>{this._popup.close(),this._elementCard.remove()}))}))};_checkLike(){const t=[];this._data.likes.forEach((e=>{t.push(e._id)})),t.includes(this._userId)&&this._cardHeart.classList.add("element__heart_active")}_checkTrash(){this._data.owner._id===this._userId&&this._trash.classList.add("element__trash_visible")}_likeToggle=()=>{this._cardHeart.classList.contains("element__heart_active")?this._api.deleteLike(this._data._id).then((t=>{this._cardHeart.classList.remove("element__heart_active"),this._heartQuantity.textContent=t.likes.length})):this._api.putLike(this._data._id).then((t=>{this._cardHeart.classList.add("element__heart_active"),this._heartQuantity.textContent=t.likes.length}))};_addListeners=()=>{this._cardTrash.addEventListener("click",this._deleteCard),this._cardImg.addEventListener("click",this._openImgPopup),this._cardHeart.addEventListener("click",this._likeToggle)};_createCard=()=>{this._card=this._template.cloneNode(!0),this._cardImg=this._card.querySelector(".element__img"),this._cardText=this._card.querySelector(".element__text"),this._cardTrash=this._card.querySelector(".element__trash"),this._cardHeart=this._card.querySelector(".element__heart"),this._heartQuantity=this._card.querySelector(".element__heart-quantity"),this._trash=this._card.querySelector(".element__trash"),this._elementCard=this._cardTrash.closest(".element"),this._cardText.textContent=this._data.name,this._heartQuantity.textContent=this._data.likes.length,this._cardImg.src=this._data.link,this._cardImg.alt=this._data.name,this._checkTrash(),this._checkLike(),this._addListeners()};getCard=()=>(this._createCard(),this._card)}(t,"#template",_,v,f,b,C).getCard()}u.setEventListeners(),document.querySelector(".profile__edit-button").addEventListener("click",(()=>{const t=_.getUserInfo();i.querySelector(".profile-edit-form__input-fild-name").value=t.name,i.querySelector(".profile-edit-form__input-fild-about").value=t.about,u.open(),h.checkFormValidity()}));const m=new r(".add-place-popup",(function(t){const e=n.querySelector(".form__button-save"),s=e.textContent;e.textContent="Сохранение...",v.addCard(t.fild_place,t.fild_img).then((t=>{o.addItem(p(t)),m.close(),l.checkFormValidity()})).finally((()=>{e.textContent=s}))}));m.setEventListeners(),document.querySelector(".profile__add-button").addEventListener("click",(()=>{l.checkFormValidity(),m.open()})),document.querySelector(".elements__list");const f=new class extends s{constructor(t){super(t),this._imgPopupImg=this._popup.querySelector(".imgPopup__img"),this._imgPopupText=this._popup.querySelector(".imgPopup__text")}open=(t,e)=>{super.open(),this._imgPopupImg.src=t.src;const s=e.textContent;this._imgPopupText.textContent=s,this._imgPopupImg.alt=`картинка места - ${s}`};close=()=>{super.close()};setEventListeners=()=>{super.setEventListeners()}}(".imgPopup");f.setEventListeners();const v=new class{constructor(){}getCards(){return fetch("https://mesto.nomoreparties.co/v1/cohort-25/cards",{headers:{authorization:"da22e24c-dd01-4958-b7cb-8f4974dde69d"}}).then((t=>{if(t.ok)return t.json()}))}getUser(){return fetch("https://mesto.nomoreparties.co/v1/cohort-25/users/me",{headers:{authorization:"da22e24c-dd01-4958-b7cb-8f4974dde69d"}}).then((t=>{if(t.ok)return t.json()})).then((t=>t)).catch((t=>{console.log(t)}))}addCard(t,e){return fetch("https://mesto.nomoreparties.co/v1/cohort-25/cards",{method:"POST",headers:{authorization:"da22e24c-dd01-4958-b7cb-8f4974dde69d","Content-Type":"application/json"},body:JSON.stringify({name:t,link:e})}).then((t=>{if(t.ok)return t.json()})).catch((t=>{console.log(t)}))}deleteCard(t){return fetch(`https://mesto.nomoreparties.co/v1/cohort-25/cards/${t}`,{method:"DELETE",headers:{authorization:"da22e24c-dd01-4958-b7cb-8f4974dde69d"}}).then((t=>{if(t.ok)return t.json()})).catch((t=>{console.log(t)}))}patchUserInfo(t,e){return fetch("https://mesto.nomoreparties.co/v1/cohort-25/users/me",{method:"PATCH",headers:{authorization:"da22e24c-dd01-4958-b7cb-8f4974dde69d","Content-Type":"application/json"},body:JSON.stringify({name:t,about:e})}).then((t=>{if(t.ok)return t.json()})).catch((t=>{console.log(t)}))}patchUserImg(t){return fetch("https://mesto.nomoreparties.co/v1/cohort-25/users/me/avatar",{method:"PATCH",headers:{authorization:"da22e24c-dd01-4958-b7cb-8f4974dde69d","Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then((t=>{if(t.ok)return t.json()})).catch((t=>{console.log(t)}))}putLike(t){return fetch(`https://mesto.nomoreparties.co/v1/cohort-25/cards/likes/${t}`,{method:"PUT",headers:{authorization:"da22e24c-dd01-4958-b7cb-8f4974dde69d","Content-Type":"application/json"}}).then((t=>{if(t.ok)return t.json()})).catch((t=>{console.log(t)}))}deleteLike(t){return fetch(`https://mesto.nomoreparties.co/v1/cohort-25/cards/likes/${t}`,{method:"DELETE",headers:{authorization:"da22e24c-dd01-4958-b7cb-8f4974dde69d","Content-Type":"application/json"}}).then((t=>{if(t.ok)return t.json()})).catch((t=>{console.log(t)}))}};v.getUser().then((t=>{_.setUserInfo(t.name,t.about),_.setUserAvatar(t.avatar),_.setUserId(t._id),v.getCards().then((t=>{t.reverse(),t.forEach((t=>{o.addItem(p(t))}))}))}));const g=document.querySelector(".profile__avatar"),y=new r(".profile-img-edit-popup",(function(t){const e=a.querySelector(".form__button-save"),s=e.textContent;e.textContent="Сохранение...",v.patchUserImg(t.fild_img).then((t=>{_.setUserAvatar(t.avatar),y.close(),a.querySelector(".form__button-save").textContent=s})).finally((()=>{e.textContent="Сохраненить"}))}));y.setEventListeners(),g.addEventListener("click",(function(){d.checkFormValidity(),y.open()}));const C=new class extends s{constructor(t){super(t),this._form=this._popup.querySelector("form")}open=()=>{super.open()};close=()=>{super.close()};setEventListeners=()=>{super.setEventListeners(),this._form.addEventListener("submit",(t=>{t.preventDefault(),this._callBack()}))};setConfirmHandler=t=>{this._callBack=t}}(".cardDelete-popup",(function(t,e){const s=c.querySelector(".form__button-save"),r=s.textContent;s.textContent="Удаление...",v.deleteCard(t).then((()=>{e.remove(),C.close()})).finally((()=>{s.textContent=r}))}));function b(t,e){C.setConfirmHandler(t,e),C.open()}C.setEventListeners()})();